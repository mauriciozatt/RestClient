unit uMain;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants,
  System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Data.DB, Vcl.StdCtrls, Vcl.Buttons,
  Vcl.ExtCtrls, Vcl.Grids, Vcl.DBGrids;

type
  TForm1 = class(TForm)
    DBGrid1: TDBGrid;
    Panel1: TPanel;
    Label1: TLabel;
    Label2: TLabel;
    edtID: TEdit;
    edtNome: TEdit;
    btnExcluir: TBitBtn;
    btnAtualizar: TBitBtn;
    btnEditar: TSpeedButton;
    btnInserir: TSpeedButton;
    procedure btnAtualizarClick(Sender: TObject);
    procedure btnExcluirClick(Sender: TObject);
    procedure FormShow(Sender: TObject);
    procedure btnInserirClick(Sender: TObject);
  private
    { Private declarations }
    procedure atualizar();
  public
    { Public declarations }
  end;

var
  Form1: TForm1;

implementation

{$R *.dfm}

uses dmDados, REST.Types;

procedure TForm1.atualizar;
begin
  Dados.bkpExecutarEndPoints.Method := rmGET;
  Dados.bkpExecutarEndPoints.ResourceSuffix := EmptyStr;
  Dados.bkpExecutarEndPoints.Execute;
end;

procedure TForm1.btnAtualizarClick(Sender: TObject);
begin
  // executa verbo Get
  atualizar();
end;

procedure TForm1.btnExcluirClick(Sender: TObject);
begin

  Dados.bkpExecutarEndPoints.Method := rmDelete;
  Dados.bkpExecutarEndPoints.ResourceSuffix := edtID.Text;;
  Dados.bkpExecutarEndPoints.Execute;

  atualizar();

end;

procedure TForm1.btnInserirClick(Sender: TObject);
var
  jParametro: TJSONObject;
begin

  jParametro := TJSONObject.Create;

  try
    jParametro.AddPair('CUST_NO', Trim(edtID.Text));
    jParametro.AddPair('COSTUMER', Trim(edtNome.Text));
    Dados.bkpExecutarEndPoints.Method := rmPUT;
    Dados.bkpExecutarEndPoints.ResourceSuffix := edtID.Text;

    {
      "country":"USA",
      "currency":"dolar"
    }

    Dados.bkpExecutarEndPoints.AddBody(jParametro);
    Dados.bkpExecutarEndPoints.Execute;
  finally
    jParametro.Free;
  end;

  btnAtualizarClick(nil);
end;

procedure TForm1.FormShow(Sender: TObject);
begin
  atualizar();
end;

end.
